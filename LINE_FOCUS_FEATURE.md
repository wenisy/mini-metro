# 线路聚焦功能

## 功能概述

新增的线路聚焦功能允许用户在复杂的地铁网络中突出显示特定线路，提升游戏体验和可读性。

## 主要特性

### 1. 视觉高亮效果

**聚焦线路**：
- 线路宽度从6px增加到10px
- 添加发光效果（shadowBlur: 8px）
- 保持原始颜色的鲜艳度

**非聚焦元素**：
- 其他线路：透明度降至0.3
- 其他站点：透明度降至0.4
- 其他列车：透明度降至0.4

**聚焦线路相关元素**：
- 聚焦线路上的站点保持正常显示
- 聚焦线路上的列车保持正常显示

### 2. 交互方式

**激活聚焦**：
- 点击左侧线路管理面板中的任意线路

**切换聚焦**：
- 点击不同线路可以切换聚焦对象

**取消聚焦**：
- 再次点击已聚焦的线路
- 点击画布空白区域
- 点击聚焦控制栏的"✕"按钮
- 按Escape键

### 3. UI指示器

**线路面板增强**：
- 聚焦线路显示🎯图标
- 边框加粗（2px）并添加发光效果
- 背景色增强显示
- 工具提示显示"点击取消聚焦"

**聚焦控制栏**：
- 显示当前聚焦的线路名称
- 提供快速取消聚焦按钮

## 技术实现

### 状态管理

```typescript
// 游戏状态中新增聚焦线路ID
export interface GameState {
  // ... 其他属性
  focusedLineId: number | null // 聚焦的线路ID
}
```

### 渲染逻辑

**线路渲染**：
```typescript
if (hasFocusedLine) {
  if (isFocused) {
    // 聚焦线路：增加宽度和发光效果
    ctx.lineWidth = 10
    ctx.shadowColor = line.color
    ctx.shadowBlur = 8
  } else {
    // 非聚焦线路：降低透明度
    ctx.globalAlpha = 0.3
  }
}
```

**站点和列车渲染**：
- 检查是否在聚焦线路上
- 应用相应的透明度效果

### 事件处理

**线路面板点击**：
```typescript
if (state.focusedLineId === id) {
  state.focusedLineId = null // 取消聚焦
} else {
  state.focusedLineId = id   // 设置聚焦
}
```

**画布点击**：
- 点击空白区域时清除聚焦状态

**键盘快捷键**：
- Escape键快速取消聚焦

## 使用场景

1. **复杂网络分析**：在多条线路交错的情况下，快速识别特定线路的走向
2. **线路规划**：专注于某条线路的扩展和优化
3. **问题诊断**：当某条线路出现拥堵时，快速定位问题区域
4. **教学演示**：向他人展示特定线路的设计思路

## 用户体验优化

- **渐进式增强**：不影响原有功能，纯粹的视觉增强
- **直观操作**：点击即可激活，符合用户直觉
- **多种取消方式**：提供多种退出聚焦的方法
- **视觉反馈**：清晰的UI指示器和状态显示
- **键盘支持**：Escape键快速取消，提升操作效率

## 兼容性

- 完全向下兼容现有功能
- 不影响游戏核心逻辑
- 可选功能，用户可以选择不使用
- 支持所有现有的交互方式
