<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Mini Metro (Web) â€” Infinite Mode</title>
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #111;
      color: #eee;
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      overflow: hidden;
    }

    #app {
      height: 100%;
      position: relative;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
      -webkit-touch-callout: none;
      -webkit-tap-highlight-color: transparent;
    }

    .overlay {
      position: fixed;
      left: 0;
      top: 0;
      padding: 8px 10px;
      font: 12px/1.4 system-ui, -apple-system, Segoe UI, Roboto;
      opacity: 0.75;
      z-index: 100;
    }
  </style>
</head>

<body>
  <div id="app">
    <canvas id="game"></canvas>
    <div class="overlay" id="hud">Loadingâ€¦</div>

    <!-- é¡¶éƒ¨ GEO åŸå¸‚é€‰æ‹©æ  -->
    <div class="overlay" style="left:50%; top:0; transform:translateX(-50%); text-align:center; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); border-radius:6px; padding:8px;">
      <!-- ç¬¬ä¸€è¡Œï¼šåŸå¸‚é€‰æ‹© -->
      <div style="margin-bottom:6px;">
        <label for="geo-city-select" style="font-size:12px; margin-right:6px; color:#ddd;">ğŸŒ åŸå¸‚:</label>
        <select id="geo-city-select" style="font-size:12px; padding:4px 6px; background:#222; color:#fff; border:1px solid #444; border-radius:4px;">
          <option value="">è¯·é€‰æ‹©åŸå¸‚</option>
          <option value="beijing">åŒ—äº¬</option>
          <option value="shanghai">ä¸Šæµ·</option>
          <option value="guangzhou">å¹¿å·</option>
          <option value="shenzhen">æ·±åœ³</option>
          <option value="tokyo">ä¸œäº¬</option>
          <option value="newyork">New York</option>
          <option value="london">London</option>
          <option value="paris">Paris</option>
          <option value="virtual">è™šæ‹Ÿåœ°å›¾ (éšæœº)</option>
        </select>
        <span style="margin:0 8px; color:#666;">æˆ–</span>
        <input type="text" id="geo-custom-city" placeholder="è¾“å…¥åŸå¸‚å" style="font-size:12px; padding:4px 6px; background:#222; color:#fff; border:1px solid #444; border-radius:4px; width:100px;">
        <button id="geo-search" style="font-size:12px; padding:4px 6px; margin-left:4px; background:#2196F3; color:#fff; border:none; border-radius:4px; cursor:pointer;">ğŸ”</button>
      </div>

      <!-- ç¬¬äºŒè¡Œï¼šè¿‡æ»¤é€‰é¡¹ -->
      <div style="margin-bottom:6px;">
        <label for="geo-station-type" style="font-size:12px; margin-right:6px; color:#ddd;">ç±»å‹:</label>
        <select id="geo-station-type" style="font-size:12px; padding:4px 6px; background:#222; color:#fff; border:1px solid #444; border-radius:4px;">
          <option value="all">å…¨éƒ¨</option>
          <option value="subway">åœ°é“ç«™</option>
          <option value="railway">ç«è½¦ç«™</option>
          <option value="entrance">åœ°é“å…¥å£</option>
        </select>
        <label for="geo-max-stations" style="font-size:12px; margin:0 6px; color:#ddd;">ä¸Šé™:</label>
        <input type="number" id="geo-max-stations" min="5" max="100" value="50" style="font-size:12px; padding:4px 6px; background:#222; color:#fff; border:1px solid #444; border-radius:4px; width:50px;">
        <label for="geo-density" style="font-size:12px; margin:0 6px; color:#ddd;">å¯†åº¦:</label>
        <input type="range" id="geo-density" min="10" max="200" step="10" value="80" style="vertical-align:middle;">
        <span id="geo-density-value" style="font-size:11px; color:#ccc; margin-left:2px;">80px</span>
      </div>

      <!-- ç¬¬ä¸‰è¡Œï¼šçº¿è·¯ç”Ÿæˆé€‰é¡¹ -->
      <div style="margin-bottom:6px;">
        <label style="font-size:12px; margin-right:6px; color:#ddd;">çº¿è·¯:</label>
        <label style="font-size:12px; margin-right:8px; color:#ccc;">
          <input type="checkbox" id="geo-auto-lines" checked style="margin-right:4px;">
          è‡ªåŠ¨ç”Ÿæˆå¤šæ¡çº¿è·¯
        </label>
        <label for="geo-line-count" style="font-size:12px; margin-right:6px; color:#ddd;">æ•°é‡:</label>
        <input type="number" id="geo-line-count" min="1" max="8" value="3" style="font-size:12px; padding:4px 6px; background:#222; color:#fff; border:1px solid #444; border-radius:4px; width:40px;">
      </div>

      <!-- ç¬¬å››è¡Œï¼šæ“ä½œæŒ‰é’® -->
      <div>
        <button id="geo-load" style="font-size:12px; padding:6px 12px; background:#4CAF50; color:#fff; border:none; border-radius:4px; cursor:pointer;">ğŸš€ åŠ è½½</button>
        <span id="geo-tip" style="font-size:11px; margin-left:8px; color:#aaa;"></span>
      </div>
    </div>

    <!-- å·¦ä¾§çº¿è·¯ç®¡ç†é¢æ¿ -->
    <div class="overlay"
      style="left: 0; top: 0; text-align: left; max-width: 280px; max-height: 80vh; overflow-y: auto;">
      <div
        style="background: rgba(0,0,0,0.3); padding:12px; border-radius:6px; border: 1px solid rgba(255,255,255,0.1); margin-bottom:8px;">
        <div style="margin-bottom:8px;">
          <strong style="font-size:14px; color:#f87171;">ğŸ›¤ï¸ çº¿è·¯ç®¡ç†</strong>
        </div>
        <div id="lines-list" style="font-size:12px; max-height: calc(80vh - 80px); overflow-y: auto;"></div>
      </div>
    </div>

    <div class="overlay" style="right: 0; left: auto; text-align: right; max-width: 280px;">

      <!-- è®¾ç½®é¢æ¿ -->
      <div
        style="margin-bottom:8px; background: rgba(0,0,0,0.3); padding:8px; border-radius:6px; border: 1px solid rgba(255,255,255,0.1);">
        <div style="margin-bottom:6px;">
          <strong style="font-size:13px; color:#4fc3f7;">âš™ï¸ è®¾ç½®</strong>
        </div>

        <div style="margin-bottom:6px;">
          <div style="margin-bottom:4px;">
            <span style="font-size:11px; color:#ccc;">æ¸¸æˆé€Ÿåº¦:</span>
          </div>
          <div style="display:flex; gap:2px;">
            <button id="btn-speed-1x"
              style="font-size:11px; padding:4px 6px; background:#666; color:#ccc; border:none; border-radius:3px; cursor:pointer;"
              title="1å€é€Ÿ">1x</button>
            <button id="btn-speed-2x"
              style="font-size:11px; padding:4px 6px; background:#666; color:#ccc; border:none; border-radius:3px; cursor:pointer;"
              title="2å€é€Ÿ">2x</button>
            <button id="btn-speed-3x"
              style="font-size:11px; padding:4px 6px; background:#666; color:#ccc; border:none; border-radius:3px; cursor:pointer;"
              title="3å€é€Ÿ">3x</button>
          </div>
        </div>

        <div style="margin-bottom:6px;">
          <button id="toggle-pause"
            style="font-size:11px; width:100%; padding:4px; background:#666; color:#ccc; border:none; border-radius:3px; cursor:pointer;">â¸ï¸
            æš‚åœæ¸¸æˆ: å…³é—­</button>
        </div>

        <div style="margin-bottom:6px;">
          <div style="margin-bottom:4px;">
            <span style="font-size:11px; color:#ccc;">ä¹˜å®¢ç”Ÿæˆ:</span>
          </div>
          <div style="display:flex; align-items:center; gap:4px;">
            <button id="passenger-rate-decrease"
              style="font-size:11px; width:20px; height:20px; padding:0; background:#666; color:#ccc; border:none; border-radius:2px; cursor:pointer;">â–</button>
            <input type="range" id="passenger-rate" min="1" max="10" step="1" value="1" style="flex:1; height:4px;">
            <button id="passenger-rate-increase"
              style="font-size:11px; width:20px; height:20px; padding:0; background:#666; color:#ccc; border:none; border-radius:2px; cursor:pointer;">â•</button>
            <span id="passenger-rate-value" style="font-size:11px; color:#fff; min-width:12px;">1</span>
          </div>
        </div>

        <div style="margin-bottom:6px;">
          <button id="toggle-auto"
            style="font-size:11px; width:100%; padding:4px; background:#666; color:#ccc; border:none; border-radius:3px; cursor:pointer;">è‡ªåŠ¨ç”Ÿæˆ:
            å…³é—­</button>
        </div>

        <div style="margin-bottom:6px;">
          <button id="spawn-one"
            style="font-size:11px; width:100%; padding:4px; background:#666; color:#ccc; border:none; border-radius:3px; cursor:pointer;">+
            æ·»åŠ ç«™ç‚¹</button>
        </div>

        <div style="margin-bottom:6px;">
          <button id="toggle-viewport-spawn"
            style="font-size:11px; width:100%; padding:4px; background:#666; color:#ccc; border:none; border-radius:3px; cursor:pointer;">ğŸ“
            è§†é‡å†…ç”Ÿæˆ: å¼€å¯</button>
        </div>


        <div style="margin-bottom:6px;">
          <button id="toggle-delete-mode"
            style="font-size:11px; width:100%; padding:4px; background:#ff4757; color:#fff; border:none; border-radius:3px; cursor:pointer;">åˆ é™¤æ¨¡å¼:
            å…³é—­</button>
        </div>

        <div style="margin-bottom:0;">
          <button id="toggle-infinite-mode"
            style="font-size:11px; width:100%; padding:4px; background:#4CAF50; color:#fff; border:none; border-radius:3px; cursor:pointer;">ğŸ’°
            æ— é™æ¨¡å¼: å…³é—­</button>
        </div>
      </div>

      <!-- æ•°æ®ä¿å­˜é¢æ¿ -->
      <div
        style="margin-bottom:8px; background: rgba(0,0,0,0.3); padding:8px; border-radius:6px; border: 1px solid rgba(255,255,255,0.1);">
        <div style="margin-bottom:6px;">
          <strong style="font-size:13px; color:#ff9800;">ğŸ’¾ æ•°æ®ç®¡ç†</strong>
        </div>

        <div style="display:flex; gap:4px;">
          <button id="btn-export-data"
            style="font-size:11px; flex:1; padding:4px; background:#2196F3; color:#fff; border:none; border-radius:3px; cursor:pointer;"
            title="å¯¼å‡ºæ¸¸æˆæ•°æ®åˆ°æ–‡ä»¶">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
          <button id="btn-import-data"
            style="font-size:11px; flex:1; padding:4px; background:#FF9800; color:#fff; border:none; border-radius:3px; cursor:pointer;"
            title="ä»æ–‡ä»¶å¯¼å…¥æ¸¸æˆæ•°æ®">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
        </div>
      </div>

      <!-- æ¸¸æˆä¿¡æ¯é¢æ¿ -->
      <div
        style="margin-bottom:8px; background: rgba(0,0,0,0.3); padding:8px; border-radius:6px; border: 1px solid rgba(255,255,255,0.1);">
        <div style="margin-bottom:6px;">
          <strong style="font-size:13px; color:#81c784;">ğŸ“Š æ¸¸æˆä¿¡æ¯</strong>
        </div>

        <!-- è´¢åŠ¡çŠ¶å†µ -->
        <div
          style="margin-bottom:8px; background: rgba(0,100,0,0.15); padding:6px; border-radius:4px; border: 1px solid rgba(0,255,0,0.2);">
          <div style="margin-bottom:4px;">
            <strong style="font-size:11px; color:#4ade80;">ğŸ’° è´¢åŠ¡çŠ¶å†µ</strong>
          </div>
          <div style="font-size:10px; color:#fff; line-height:1.4;">
            <div>ä½™é¢: $<span id="money-balance">500</span></div>
            <div>æ€»æ”¶å…¥: $<span id="total-income">0</span></div>
            <div>æ€»æ”¯å‡º: $<span id="total-expense">0</span></div>
          </div>
        </div>

        <!-- ä¹˜å®¢ç»Ÿè®¡ -->
        <div
          style="margin-bottom:8px; background: rgba(100,100,255,0.15); padding:6px; border-radius:4px; border: 1px solid rgba(100,100,255,0.2);">
          <div style="margin-bottom:4px;">
            <strong style="font-size:11px; color:#60a5fa;">ğŸ‘¥ ä¹˜å®¢ç»Ÿè®¡</strong>
          </div>
          <div style="font-size:10px; color:#fff; line-height:1.4;">
            <div>å·²è¿é€: <span id="total-passengers">0</span> äºº</div>
            <div>ç­‰å¾…ä¸­: <span id="waiting-passengers">0</span> äºº</div>
          </div>
        </div>

        <!-- æ¸¸æˆç»Ÿè®¡ -->
        <div
          style="margin-bottom:8px; background: rgba(255,100,100,0.15); padding:6px; border-radius:4px; border: 1px solid rgba(255,100,100,0.2);">
          <div style="margin-bottom:4px;">
            <strong style="font-size:11px; color:#f87171;">ğŸ“ˆ æ¸¸æˆç»Ÿè®¡</strong>
          </div>
          <div style="font-size:10px; color:#fff; line-height:1.4;">
            <div>æ¸¸æˆæ—¶é—´: <span id="game-time">0.0</span> ç§’</div>
            <div>ç«™ç‚¹æ•°é‡: <span id="station-count">0</span> ä¸ª</div>
            <div>åˆ—è½¦æ•°é‡: <span id="train-count">0</span> è¾†</div>
          </div>
        </div>

        <!-- æ™ºèƒ½æ¢ä¹˜ç»Ÿè®¡ -->
        <div
          style="margin-bottom:0; background: rgba(76,175,80,0.15); padding:6px; border-radius:4px; border: 1px solid rgba(76,175,80,0.2);">
          <div style="margin-bottom:4px;">
            <strong style="font-size:11px; color:#4CAF50;">ğŸ”„ æ¢ä¹˜ç»Ÿè®¡</strong>
          </div>
          <div id="transfer-stats-content" style="font-size:10px; color:#fff; line-height:1.4;">
            <!-- æ¢ä¹˜ç»Ÿè®¡å†…å®¹å°†ç”±JavaScriptå¡«å…… -->
          </div>
        </div>

      </div>

      <!-- å¸®åŠ©æç¤º -->
      <div
        style="background: rgba(0,0,0,0.2); padding:6px; border-radius:4px; border: 1px solid rgba(255,255,255,0.1);">
        <div style="font-size:10px; opacity:0.8; line-height:1.3;">
          <strong style="color:#fbbf24;">ğŸ’¡ æ“ä½œæç¤º:</strong><br>
          â€¢ ç‚¹å‡»ç«™ç‚¹è¿æ¥çº¿è·¯<br>
          â€¢ æ‹–æ‹½çº¿è·¯å¯æ™ºèƒ½å¸é™„<br>
          â€¢ å³é”®æˆ–åˆ é™¤æ¨¡å¼ç§»é™¤çº¿è·¯<br>
          â€¢ ç‚¹å‡»çº¿è·¯åç§°èšç„¦é«˜äº®<br>
          â€¢ æŒ‰Escapeé”®å–æ¶ˆèšç„¦
        </div>
      </div>
    </div>
    <div id="link-chooser"
      style="position:absolute; background:rgba(0,0,0,0.9); color:white; padding:12px; border-radius:8px; z-index:1000; box-shadow:0 4px 12px rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.2); display:none; min-width:200px;">
      <div id="link-chooser-text" style="margin-bottom:8px; font-size:14px">é€‰æ‹©æ“ä½œ</div>
      <div id="link-chooser-buttons" style="display:flex; flex-wrap:wrap; gap:8px"></div>
    </div>


  </div>
  <script type="module" src="/src/main.ts"></script>
</body>

</html>